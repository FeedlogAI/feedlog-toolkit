<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>feedlog-github-issues-client Playground</title>
    <script type="module" src="./dist/feedlog-toolkit/feedlog-toolkit.esm.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 40px;
        color: #2c3e50;
      }

      h1 {
        font-size: 2.5rem;
        margin-bottom: 8px;
      }

      .subtitle {
        font-size: 1.1rem;
        color: #7f8c8d;
      }

      .main-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      .card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 24px;
      }

      .controls-panel {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .control-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      label {
        font-weight: 600;
        color: #2c3e50;
        font-size: 0.95rem;
      }

      input[type='text'],
      input[type='number'],
      select,
      input[type='range'] {
        padding: 10px 12px;
        border: 2px solid #e0e6ed;
        border-radius: 6px;
        font-size: 0.95rem;
        transition: border-color 0.2s;
      }

      input[type='text']:focus,
      input[type='number']:focus,
      select:focus,
      input[type='range']:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
      }

      .input-helper {
        font-size: 0.85rem;
        color: #7f8c8d;
        margin-top: 4px;
      }

      .slider-container {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      input[type='range'] {
        flex: 1;
        padding: 0;
        height: 6px;
        border: none;
        border-radius: 3px;
        -webkit-appearance: none;
        appearance: none;
        background: #e0e6ed;
      }

      input[type='range']::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #3498db;
        cursor: pointer;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      input[type='range']::-moz-range-thumb {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #3498db;
        cursor: pointer;
        border: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .limit-value {
        min-width: 40px;
        text-align: center;
        font-weight: 600;
        color: #3498db;
      }

      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }

      button {
        padding: 12px 20px;
        border: none;
        border-radius: 6px;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-primary {
        background: #3498db;
        color: white;
        flex: 1;
      }

      .btn-primary:hover {
        background: #2980b9;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
      }

      .btn-primary:active {
        transform: translateY(0);
      }

      .btn-secondary {
        background: #ecf0f1;
        color: #2c3e50;
        flex: 1;
      }

      .btn-secondary:hover {
        background: #d5dbdb;
        transform: translateY(-2px);
      }

      .theme-toggle {
        display: flex;
        gap: 8px;
      }

      .theme-button {
        flex: 1;
        padding: 10px 16px;
        border: 2px solid #e0e6ed;
        background: white;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s;
      }

      .theme-button.active {
        background: #3498db;
        color: white;
        border-color: #3498db;
      }

      .theme-button:hover {
        border-color: #3498db;
      }

      .preview-panel {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .preview-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .preview-header h2 {
        font-size: 1.3rem;
        color: #2c3e50;
      }

      .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
      }

      .status-badge.ready {
        background: #2ecc71;
        color: white;
      }

      .status-badge.error {
        background: #e74c3c;
        color: white;
      }

      .status-badge.no-key {
        background: #f39c12;
        color: white;
      }

      .preview-container {
        background: #f8f9fa;
        border: 2px dashed #bdc3c7;
        border-radius: 8px;
        padding: 20px;
        min-height: 300px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: auto;
      }

      .no-key-message {
        text-align: center;
        color: #7f8c8d;
      }

      .no-key-message p {
        margin: 10px 0;
        font-size: 0.95rem;
      }

      .no-key-message strong {
        color: #f39c12;
      }

      .full-width {
        grid-column: 1 / -1;
      }

      .debug-panel {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .debug-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .debug-header h2 {
        font-size: 1.3rem;
        color: #2c3e50;
      }

      .event-log {
        background: #f8f9fa;
        border: 1px solid #e0e6ed;
        border-radius: 8px;
        padding: 12px;
        height: 300px;
        overflow-y: auto;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 0.85rem;
      }

      .event-entry {
        padding: 8px;
        margin-bottom: 8px;
        border-left: 4px solid;
        border-radius: 2px;
        background: white;
      }

      .event-entry.upvote {
        border-left-color: #3498db;
        background: #ecf0f1;
      }

      .event-entry.error {
        border-left-color: #e74c3c;
        background: #fadbd8;
      }

      .event-entry.info {
        border-left-color: #2ecc71;
        background: #d5f4e6;
      }

      .event-time {
        font-weight: 600;
        color: #7f8c8d;
        font-size: 0.8rem;
      }

      .event-type {
        font-weight: 600;
        margin: 4px 0;
      }

      .event-data {
        color: #555;
        margin-top: 4px;
        word-break: break-all;
      }

      .empty-log {
        text-align: center;
        color: #95a5a6;
        padding: 40px 20px;
        font-style: italic;
      }

      .info-box {
        background: #d6eaf8;
        border-left: 4px solid #3498db;
        padding: 12px;
        border-radius: 4px;
        margin-bottom: 16px;
        font-size: 0.9rem;
        color: #1a4d6d;
      }

      .info-box strong {
        color: #0c3a5a;
      }

      @media (max-width: 1024px) {
        .main-layout {
          grid-template-columns: 1fr;
        }

        h1 {
          font-size: 2rem;
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 12px;
        }

        .card {
          padding: 16px;
        }

        h1 {
          font-size: 1.5rem;
        }

        .button-group {
          flex-direction: column;
        }

        button {
          width: 100%;
        }
      }

      /* Scrollbar styling */
      .event-log::-webkit-scrollbar {
        width: 8px;
      }

      .event-log::-webkit-scrollbar-track {
        background: #ecf0f1;
        border-radius: 4px;
      }

      .event-log::-webkit-scrollbar-thumb {
        background: #bdc3c7;
        border-radius: 4px;
      }

      .event-log::-webkit-scrollbar-thumb:hover {
        background: #95a5a6;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>feedlog-github-issues-client</h1>
        <p class="subtitle">Interactive Playground for Fast Prototyping & Debugging</p>
      </header>

      <div class="main-layout">
        <!-- Controls Panel -->
        <div class="card">
          <div class="controls-panel">
            <div class="info-box">
              <strong>Quick Start:</strong> Enter your Feedlog API key, adjust settings, and click
              "Update Component" to see it in action.
            </div>

            <div class="control-group">
              <label for="apiKey">API Key *</label>
              <input
                type="text"
                id="apiKey"
                placeholder="Enter your Feedlog API key"
                autocomplete="off"
              />
              <div class="input-helper">Required to fetch GitHub issues from your repositories</div>
            </div>

            <div class="control-group">
              <label for="endpoint">Endpoint</label>
              <input
                type="text"
                id="endpoint"
                placeholder="e.g., http://localhost:3100"
                value="http://localhost:3100"
              />
              <div class="input-helper">API endpoint URL for the Feedlog service</div>
            </div>

            <div class="control-group">
              <label for="type">Filter by Type</label>
              <select id="type">
                <option value="">All</option>
                <option value="bug">Bug</option>
                <option value="enhancement">Enhancement</option>
              </select>
            </div>

            <div class="control-group">
              <label for="limit">Issues Limit</label>
              <div class="slider-container">
                <input type="range" id="limit" min="1" max="100" value="10" />
                <span class="limit-value" id="limitValue">10</span>
              </div>
              <div class="input-helper">Number of issues to fetch (1-100)</div>
            </div>

            <div class="control-group">
              <label for="maxWidth">Container Max Width</label>
              <input type="text" id="maxWidth" placeholder="e.g., 42rem" value="42rem" />
              <div class="input-helper">CSS width value (e.g., 42rem, 800px, 100%)</div>
            </div>

            <div class="control-group">
              <label>Theme</label>
              <div class="theme-toggle">
                <button class="theme-button active" data-theme="light">Light</button>
                <button class="theme-button" data-theme="dark">Dark</button>
              </div>
            </div>

            <div class="control-group">
              <label>Custom Heading (Optional)</label>
              <input type="text" id="heading" placeholder="e.g., GitHub Issues" />
            </div>

            <div class="control-group">
              <label>Custom Subtitle (Optional)</label>
              <input
                type="text"
                id="subtitle"
                placeholder="e.g., Latest bug reports and features"
              />
            </div>

            <div class="button-group">
              <button class="btn-primary" id="updateBtn">Update Component</button>
              <button class="btn-secondary" id="clearEventsBtn">Clear Events</button>
            </div>
          </div>
        </div>

        <!-- Preview Panel -->
        <div class="card">
          <div class="preview-panel">
            <div class="preview-header">
              <h2>Live Preview</h2>
              <span class="status-badge" id="statusBadge">No API Key</span>
            </div>
            <div class="preview-container" id="previewContainer">
              <div class="no-key-message">
                <p>ðŸ‘‹ Welcome to the Playground!</p>
                <p>Enter your <strong>API key</strong> above to get started</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Debug Panel (Full Width) -->
      <div class="card full-width">
        <div class="debug-panel">
          <div class="debug-header">
            <h2>Event Log & Debug Console</h2>
            <button class="btn-secondary" id="clearLogBtn">Clear Log</button>
          </div>
          <div class="event-log" id="eventLog">
            <div class="empty-log">No events yet. Component events will appear here...</div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // State management
      const state = {
        apiKey: localStorage.getItem('feedlogPlaygroundApiKey') || '',
        endpoint: localStorage.getItem('feedlogPlaygroundEndpoint') || 'http://localhost:3100',
        type: '',
        limit: 10,
        maxWidth: '42rem',
        theme: 'light',
        heading: '',
        subtitle: '',
      };

      const elements = {
        apiKey: document.getElementById('apiKey'),
        endpoint: document.getElementById('endpoint'),
        type: document.getElementById('type'),
        limit: document.getElementById('limit'),
        limitValue: document.getElementById('limitValue'),
        maxWidth: document.getElementById('maxWidth'),
        heading: document.getElementById('heading'),
        subtitle: document.getElementById('subtitle'),
        themeButtons: document.querySelectorAll('.theme-button'),
        updateBtn: document.getElementById('updateBtn'),
        clearEventsBtn: document.getElementById('clearEventsBtn'),
        clearLogBtn: document.getElementById('clearLogBtn'),
        previewContainer: document.getElementById('previewContainer'),
        eventLog: document.getElementById('eventLog'),
        statusBadge: document.getElementById('statusBadge'),
      };

      let componentElement = null;
      const events = [];

      // Initialize UI
      function initializeUI() {
        elements.apiKey.value = state.apiKey;
        elements.endpoint.value = state.endpoint;
        elements.type.value = state.type;
        elements.limit.value = state.limit;
        elements.limitValue.textContent = state.limit;
        elements.maxWidth.value = state.maxWidth;
        elements.heading.value = state.heading;
        elements.subtitle.value = state.subtitle;

        // Set active theme button
        elements.themeButtons.forEach(btn => {
          btn.classList.toggle('active', btn.dataset.theme === state.theme);
        });
      }

      // Event listeners
      elements.limit.addEventListener('input', e => {
        state.limit = parseInt(e.target.value);
        elements.limitValue.textContent = state.limit;
      });

      elements.themeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          state.theme = btn.dataset.theme;
          elements.themeButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
        });
      });

      elements.updateBtn.addEventListener('click', updateComponent);
      elements.clearEventsBtn.addEventListener('click', clearEvents);
      elements.clearLogBtn.addEventListener('click', clearLog);

      // Update component
      function updateComponent() {
        // Update state from inputs
        state.apiKey = elements.apiKey.value.trim();
        state.endpoint = elements.endpoint.value.trim();
        state.type = elements.type.value;
        state.limit = parseInt(elements.limit.value);
        state.maxWidth = elements.maxWidth.value;
        state.heading = elements.heading.value;
        state.subtitle = elements.subtitle.value;

        // Save API key and endpoint to localStorage
        if (state.apiKey) {
          localStorage.setItem('feedlogPlaygroundApiKey', state.apiKey);
        }
        localStorage.setItem('feedlogPlaygroundEndpoint', state.endpoint);

        // Clear previous component
        elements.previewContainer.innerHTML = '';

        if (!state.apiKey) {
          updateStatusBadge('no-key');
          elements.previewContainer.innerHTML = `
          <div class="no-key-message">
            <p>ðŸ‘‹ Welcome to the Playground!</p>
            <p>Enter your <strong>API key</strong> to load the component</p>
          </div>
        `;
          return;
        }

        // Create and configure component
        componentElement = document.createElement('feedlog-github-issues-client');
        componentElement.apiKey = state.apiKey;
        componentElement.endpoint = state.endpoint;
        if (state.type) componentElement.type = state.type;
        if (state.limit) componentElement.limit = state.limit;
        componentElement.maxWidth = state.maxWidth;
        componentElement.theme = state.theme;
        if (state.heading) componentElement.heading = state.heading;
        if (state.subtitle) componentElement.subtitle = state.subtitle;

        // Attach event listeners
        componentElement.addEventListener('feedlogUpvote', handleUpvoteEvent);
        componentElement.addEventListener('feedlogError', handleErrorEvent);

        // Mount component
        elements.previewContainer.appendChild(componentElement);
        updateStatusBadge('ready');

        logEvent('info', 'Component Updated', {
          apiKey: state.apiKey ? 'âœ“ Set' : 'âœ— Missing',
          endpoint: state.endpoint,
          type: state.type || 'all',
          limit: state.limit,
          theme: state.theme,
          maxWidth: state.maxWidth,
        });
      }

      // Event handlers
      function handleUpvoteEvent(event) {
        logEvent('upvote', 'Issue Upvoted', event.detail);
      }

      function handleErrorEvent(event) {
        logEvent('error', 'Error', event.detail);
        updateStatusBadge('error');
      }

      // Logging
      function logEvent(type, title, data) {
        const entry = {
          type,
          title,
          data,
          time: new Date(),
        };
        events.unshift(entry);

        // Keep only last 50 events
        if (events.length > 50) {
          events.pop();
        }

        renderEventLog();
      }

      function renderEventLog() {
        if (events.length === 0) {
          elements.eventLog.innerHTML =
            '<div class="empty-log">No events yet. Component events will appear here...</div>';
          return;
        }

        elements.eventLog.innerHTML = events
          .map(
            (entry, index) => `
        <div class="event-entry ${entry.type}">
          <div class="event-time">${formatTime(entry.time)}</div>
          <div class="event-type">${entry.title}</div>
          <div class="event-data">${JSON.stringify(entry.data, null, 2)}</div>
        </div>
      `
          )
          .join('');

        // Scroll to top
        elements.eventLog.scrollTop = 0;
      }

      function formatTime(date) {
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        const seconds = String(date.getSeconds()).padStart(2, '0');
        const ms = String(date.getMilliseconds()).padStart(3, '0');
        return `${hours}:${minutes}:${seconds}.${ms}`;
      }

      function clearEvents() {
        if (componentElement) {
          const container = elements.previewContainer;
          container.innerHTML = '';
          componentElement = null;
          logEvent('info', 'Events Cleared', { action: 'Component removed' });
        }
      }

      function clearLog() {
        events.length = 0;
        renderEventLog();
      }

      function updateStatusBadge(status) {
        elements.statusBadge.className = 'status-badge';
        const statusTexts = {
          'no-key': 'No API Key',
          ready: 'Ready',
          error: 'Error',
        };
        elements.statusBadge.textContent = statusTexts[status];
        elements.statusBadge.classList.add(status);
      }

      // Initialize
      initializeUI();

      // Auto-load component if API key exists in localStorage
      if (state.apiKey) {
        setTimeout(updateComponent, 100);
      }
    </script>
  </body>
</html>
